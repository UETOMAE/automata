#!/bin/bash

#
# Prepare and validate test environment
#
export LOCAL_MODE=true
BIN_DIR=$(cd $(dirname $0); pwd)
. $BIN_DIR/test_automata_env

#
# Parse options
#
export BROWSER=chrome
while getopts "b:" OPT; do
  case $OPT in
    b)  export BROWSER=$OPTARG
        ;;
    h)  exit_with_usage
        ;;
    \?) exit_with_usage
        ;;
  esac
done
shift $((OPTIND - 1))
TARGET_CASE=$TEST_CASES
[ $# -ne 0 ] && TARGET_CASE="$@"

#
# Detect if script is running on docker container
#
export RUN_ON_DOCKER=false
[ -f /.dockerenv ] && RUN_ON_DOCKER=true

#
# Run test
#
if [ $RUN_ON_DOCKER == "true" ]; then
  Xvfb :99 -ac -screen 0 ${SCREEN_WIDTH}x${SCREEN_HEIGHT}x${SCREEN_COLOR_DEPTH} &
  export DISPLAY=:99
fi
robot --outputdir $TEST_RESULTS $TARGET_CASE
